<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mon Meal Prep Perso</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f2f2f7; padding: 20px; color: #1c1c1e; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h2 { font-size: 1.2rem; margin-top: 0; color: #007aff; }
        input, select { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { background: #34c759; color: white; border: none; padding: 12px; width: 100%; border-radius: 8px; font-weight: bold; margin-top: 10px; }
        .btn-add { background: #007aff; }
        .recipe-item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 10px 0; }
        .shopping-list { background: #fff9c4; border-left: 5px solid #fbc02d; }
    </style>
</head>
<body>

    <a href="index.html" style="text-decoration:none;">‚Üê Accueil</a>
    <h1>Meal Prep Designer</h1>

    <div class="card">
        <h2>‚ûï Ajouter une Recette</h2>
        <input type="text" id="recName" placeholder="Nom de la recette (ex: Poulet Curry)">
        <input type="text" id="recIng" placeholder="Ingr√©dients (ex: Poulet:150, Riz:60)">
        <small>Format : Nom:Quantit√©, Nom:Quantit√©</small>
        <input type="number" id="recCal" placeholder="Calories (kcal)">
        <button class="btn-add" onclick="saveRecipe()">Enregistrer la Recette</button>
    </div>

    <div class="card">
        <h2>üóìÔ∏è Planifier ma semaine</h2>
        <div id="recipeSelectors">
            </div>
        <button onclick="generateList()">G√©n√©rer Liste de Courses</button>
    </div>

    <div class="card shopping-list" id="finalList" style="display:none;">
        <h2>üõí Ma Liste de Courses</h2>
        <ul id="listItems"></ul>
    </div>

    <script>
        let myRecipes = JSON.parse(localStorage.getItem('myRecipes')) || [];

        function saveRecipe() {
            const name = document.getElementById('recName').value;
            const ingRaw = document.getElementById('recIng').value;
            const cal = document.getElementById('recCal').value;

            if(!name || !ingRaw) return alert("Remplissez le nom et les ingr√©dients");

            // Transformation du texte "Poulet:150, Riz:60" en objet utilisable
            const ingredients = ingRaw.split(',').map(item => {
                const [nom, qte] = item.split(':');
                return { nom: nom.trim(), qte: parseFloat(qte) };
            });

            const newRecipe = { name, ingredients, cal };
            myRecipes.push(newRecipe);
            localStorage.setItem('myRecipes', JSON.stringify(myRecipes));
            
            alert("Recette ajout√©e !");
            location.reload(); // Rafra√Æchit pour afficher la nouvelle recette
        }

        function displaySelectors() {
            const container = document.getElementById('recipeSelectors');
            if(myRecipes.length === 0) container.innerHTML = "<p>Aucune recette enregistr√©e.</p>";
            
            myRecipes.forEach((rec, index) => {
                container.innerHTML += `
                    <div class="recipe-item">
                        <span><strong>${rec.name}</strong> (${rec.cal} kcal)</span>
                        <select id="qty-${index}" style="width: 80px;">
                            <option value="0">0j</option>
                            <option value="1">1j</option>
                            <option value="2">2j</option>
                            <option value="3">3j</option>
                        </select>
                    </div>
                `;
            });
        }

        function generateList() {
            let totalShopping = {};
            
            myRecipes.forEach((rec, index) => {
                const multiplier = document.getElementById(`qty-${index}`).value;
                if(multiplier > 0) {
                    rec.ingredients.forEach(ing => {
                        totalShopping[ing.nom] = (totalShopping[ing.nom] || 0) + (ing.qte * multiplier);
                    });
                }
            });

            const listUl = document.getElementById('listItems');
            listUl.innerHTML = "";
            for (const [item, qte] of Object.entries(totalShopping)) {
                listUl.innerHTML += `<li>${item} : <strong>${qte}</strong></li>`;
            }
            document.getElementById('finalList').style.display = "block";
        }

        displaySelectors();
    </script>
</body>
</html>

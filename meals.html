<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Meal Prep Pro</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f2f2f7; padding: 15px; color: #1c1c1e; padding-bottom: 50px; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 15px; }
        h2 { font-size: 1.1rem; color: #007aff; margin-top: 0; }
        
        /* Style du formulaire d'ingr√©dients */
        .ing-row { display: flex; gap: 5px; margin-bottom: 8px; }
        input, select { padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; }
        .ing-name { flex: 2; }
        .ing-qty { flex: 1; }
        .ing-unit { flex: 1; }

        button { border: none; border-radius: 8px; padding: 12px; font-weight: bold; cursor: pointer; }
        .btn-blue { background: #007aff; color: white; width: 100%; margin-top: 10px; }
        .btn-green { background: #34c759; color: white; width: 100%; margin-top: 15px; }
        .btn-outline { background: #e5e5ea; color: #007aff; font-size: 12px; padding: 5px 10px; }
        
        .recipe-selection { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
        .shopping-list { background: #fff9c4; border-left: 5px solid #fbc02d; list-style: none; padding-left: 15px; }
        .shopping-list li { margin-bottom: 8px; }
    </style>
</head>
<body>

    <nav><a href="index.html" style="text-decoration:none;">‚Üê Accueil</a></nav>
    <h1>Chef Prep üç≥</h1>

    <div class="card">
        <h2>‚ûï Nouvelle Recette</h2>
        <input type="text" id="recName" placeholder="Nom du plat (ex: Risotto)">
        <input type="number" id="recCal" placeholder="Calories par portion">
        
        <div id="ingredientsContainer">
            <p style="font-size: 12px; font-weight: bold; margin-bottom: 5px;">Ingr√©dients :</p>
            <div class="ing-row">
                <input type="text" class="ing-name" placeholder="Nom">
                <input type="number" class="ing-qty" placeholder="Qt√©">
                <select class="ing-unit">
                    <option value="g">g</option>
                    <option value="ml">ml</option>
                    <option value="tbsp">tbsp</option>
                    <option value="tsp">tsp</option>
                    <option value="unit√©">unit√©</option>
                </select>
            </div>
        </div>
        
        <button class="btn-outline" onclick="addIngredientRow()">+ Ajouter un ingr√©dient</button>
        <button class="btn-blue" onclick="saveRecipe()">Enregistrer la Recette</button>
    </div>

    <div class="card">
        <h2>üóìÔ∏è Planifier</h2>
        <div id="recipeSelectors"></div>
        <button class="btn-green" onclick="generateList()">üõí Cr√©er ma liste de courses</button>
    </div>

    <div class="card shopping-list" id="finalList" style="display:none;">
        <h2>Ma Liste de Courses</h2>
        <ul id="listItems" style="padding: 0;"></ul>
        <button class="btn-outline" style="margin-top: 10px;" onclick="document.getElementById('finalList').style.display='none'">Fermer</button>
    </div>

    <script>
        let myRecipes = JSON.parse(localStorage.getItem('myRecipes')) || [];

        function addIngredientRow() {
            const container = document.getElementById('ingredientsContainer');
            const newRow = document.createElement('div');
            newRow.className = 'ing-row';
            newRow.innerHTML = `
                <input type="text" class="ing-name" placeholder="Nom">
                <input type="number" class="ing-qty" placeholder="Qt√©">
                <select class="ing-unit">
                    <option value="g">g</option>
                    <option value="ml">ml</option>
                    <option value="tbsp">tbsp</option>
                    <option value="tsp">tsp</option>
                    <option value="unit√©">unit√©</option>
                </select>
            `;
            container.appendChild(newRow);
        }

        function saveRecipe() {
            const name = document.getElementById('recName').value;
            const cal = document.getElementById('recCal').value;
            const rows = document.querySelectorAll('.ing-row');
            
            let ingredients = [];
            rows.forEach(row => {
                const n = row.querySelector('.ing-name').value;
                const q = row.querySelector('.ing-qty').value;
                const u = row.querySelector('.ing-unit').value;
                if(n && q) ingredients.push({ nom: n, qte: parseFloat(q), unite: u });
            });

            if(!name || ingredients.length === 0) return alert("Nom et ingr√©dients requis !");

            myRecipes.push({ name, cal, ingredients });
            localStorage.setItem('myRecipes', JSON.stringify(myRecipes));
            alert("Recette sauvegard√©e !");
            location.reload();
        }

        function displaySelectors() {
            const container = document.getElementById('recipeSelectors');
            if(myRecipes.length === 0) return container.innerHTML = "<p>Ajoutez d'abord des recettes.</p>";
            
            myRecipes.forEach((rec, index) => {
                container.innerHTML += `
                    <div class="recipe-selection">
                        <span><strong>${rec.name}</strong> (${rec.cal} kcal)</span>
                        <select id="qty-${index}" style="width: auto;">
                            <option value="0">0 portion</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                    </div>
                `;
            });
        }

        function generateList() {
            let totalShopping = {}; // Format: { "Sucre-g": 100, "Lait-ml": 200 }

            myRecipes.forEach((rec, index) => {
                const multiplier = document.getElementById(`qty-${index}`).value;
                if(multiplier > 0) {
                    rec.ingredients.forEach(ing => {
                        const key = `${ing.nom}|${ing.unite}`; // On groupe par nom ET unit√©
                        totalShopping[key] = (totalShopping[key] || 0) + (ing.qte * multiplier);
                    });
                }
            });

            const listUl = document.getElementById('listItems');
            listUl.innerHTML = "";
            
            for (const [key, qte] of Object.entries(totalShopping)) {
                const [nom, unite] = key.split('|');
                listUl.innerHTML += `<li>‚úÖ ${nom} : <strong>${qte} ${unite}</strong></li>`;
            }
            document.getElementById('finalList').style.display = "block";
        }

        displaySelectors();
    </script>
</body>
</html>
